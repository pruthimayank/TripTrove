<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking History</title>
    <!-- Add your CSS or Bootstrap links here -->
</head>
<body>

    {% extends 'base.html' %}

    {% block content %}
    <main>
        <!-- Upcoming Bookings Section -->
        <section>
            <h2>Upcoming Bookings</h2>
            {% with upcoming_found=False %}
                {% for booking in booking_history %}
                    <!-- Debug info for troubleshooting -->
                    <p>Booking Data: {{ booking }}</p>
                    <p>Slot Start: {{ booking.slot_start }}</p>
                    <p>Current Date: {{ current_date }}</p>
                    
                    {% if booking.slot_start and booking.slot_start > current_date %}
                        {% with upcoming_found=True %}
                        <div class="row mx-2 my-4 rounded-2" style="background: linear-gradient(to top, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.5) 100%), url(https://res.cloudinary.com/chatgixbot/image/upload/v1725441469/gn5jzqnt14shpk8tckb4.jpg); background-size: cover; background-repeat: no-repeat;">
                            <div class="col-md-7 mt-2">
                                <section class="how-we-work px-2 rounded-2">
                                    <div class="d-flex flex-column justify-content-center p-2 h-100">
                                        <small>Your booking for</small>
                                        <h1>{{ booking.first_name }} {{ booking.last_name }}</h1>
                                        <br>
                                        <p>Your booking history will be shown here</p>
                                        <a href="/packages" class="text-white">Discover more packages</a>
                                    </div>
                                </section>
                            </div>
                            <div class="col-md-5 mt-2">
                                <br><br><br>
                                <div class="card p-3" style="background-color: #00000025; color: white;">
                                    <div class="d-flex flex-wrap align-items-center justify-content-between">
                                        <div>
                                            <h5>Booking is</h5>
                                            <h4>Confirmed!</h4>
                                        </div>
                                        <div>
                                            <img width="60" height="60" src="https://img.icons8.com/dotty/ffffff/80/checked.png" alt="checked"/>
                                        </div>
                                    </div>
                                    <p>We will get back to you soon!</p>
                                    <div class="mt-2 border border-light rounded-2 p-3">
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Check In:</p>
                                            <p>{{ booking.slot_start }}</p> 
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Check Out:</p>
                                            <p>{{ booking.slot_end }}</p>
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Guests:</p>
                                            <p>{{ booking.guests }}</p> <!-- Use correct variable for guests if exists -->
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <h4>Total Paid:</h4>
                                            <h4>₹{{ booking.total_amount }}</h4>
                                        </div>
                                    </div>
                                </div>
                                <br>
                            </div>
                        </div>
                        {% endwith %}
                    {% endif %}
                {% endfor %}

                <!-- Show message if no upcoming bookings -->
                {% if not upcoming_found %}
                    <div class="text-center">
                        <h1>No upcoming bookings found.</h1>
                    </div>
                {% endif %}
            {% endwith %}
        </section>

        <!-- Previous Bookings Section -->
        <section>
            <h2>Previous Bookings</h2>
            {% with previous_found=False %}
                {% for booking in booking_history %}
                    {% if booking.slot_end and booking.slot_end <= current_date %}
                        {% with previous_found=True %}
                        <div class="row mx-2 my-4 rounded-2" style="background: linear-gradient(to top, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.5) 100%), url(https://static.vecteezy.com/system/resources/thumbnails/026/542/204/small_2x/landscape-natural-beautiful-mountains-and-blue-sky-panorama-photo.jpg); background-size: cover;">
                            <div class="col-md-7 mt-2">
                                <section class="how-we-work px-2 rounded-2">
                                    <div class="d-flex flex-column justify-content-center p-2 h-100">
                                        <small>Your booking for</small>
                                        <h1>{{ booking.first_name }} {{ booking.last_name }}</h1>
                                        <br>
                                        <p>Your booking history will be shown here</p>
                                        <a href="/packages" class="text-white">Discover more packages</a>
                                    </div>
                                </section>
                            </div>
                            <div class="col-md-5 mt-2">
                                <br><br><br>
                                <div class="card p-3" style="background-color: #00000025; color: white;">
                                    <div class="d-flex flex-wrap align-items-center justify-content-between">
                                        <div>
                                            <h5>Booking is</h5>
                                            <h4>Confirmed!</h4>
                                        </div>
                                        <div>
                                            <img width="60" height="60" src="https://img.icons8.com/dotty/ffffff/80/checked.png" alt="checked"/>
                                        </div>
                                    </div>
                                    <p>We will get back to you soon!</p>
                                    <div class="mt-2 border border-light rounded-2 p-3">
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Check In:</p>
                                            <p>{{ booking.slot_start }}</p> 
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Check Out:</p>
                                            <p>{{ booking.slot_end }}</p>
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <p>Guests:</p>
                                            <p>{{ booking.guests }}</p> <!-- Use correct variable for guests if exists -->
                                        </div>
                                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                                            <h4>Total Paid:</h4>
                                            <h4>₹{{ booking.total_amount }}</h4>
                                        </div>
                                    </div>
                                </div>
                                <br>
                            </div>
                        </div>
                        {% endwith %}
                    {% endif %}
                {% endfor %}

                <!-- Show message if no previous bookings -->
                {% if not previous_found %}
                    <p>No previous bookings found.</p>
                {% endif %}
            {% endwith %}
        </section>
    </main>
    {% endblock %}

</body>
</html>
